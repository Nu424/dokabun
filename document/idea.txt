●ーーどかぶん
AIの力を借りて、どかっと分析するツール

ーー使う流れ
スプレッドシート(Excel,csv)に、分析対象・分析内容を入力する
　分析対象：テキストそのまま、パス(ローカルのファイル(画像)、ウェブページ、など)
　　「t_xxx」という列名を、分析対象とする
　　分析対象が複数列ある場合は、左側から結合した全体を分析する
　　ひとまずは、そのままのテキストと、ローカルの画像ファイルのみを対象とする
　　　後述するように、拡張性を意識した構造で実装する
　分析内容：構造化出力の形式を決める
　　分析は、LLMの構造化出力でおこなう
　　列名が、構造化出力のプロパティになる
　　「{列名}|{説明}」のような形式で列に記述する
　　　説明は、構造化出力のスキーマのdecriptionになる
　💬スプレッドシートをインターフェースとして、簡単にLLM分析ができるのがポイント

分析する
　ファイルを、実行時引数、またはファイルダイアログで入力してもらう
　スプレッドシートの各行について、並列で処理をおこなう
　　OpenRouterを使用する
　　　分析に使うモデルは指定できるようにする
　　　非同期でおこなう
　　同時並列数はasyncio.Semaphoreかなんかで制限する
　進捗状況はtqdmかなんかで表示する
　分析結果をスプレッドシートにまとめる
　処理が完了したら、サマリーを出力する
　　実行時間、かかった費用、エラーなど

ーー実装にあたり
モジュール化を意識し、拡張性を高くする
　分析対象でのパス指定で、画像以外(PDFとか)も読み込めるようにするかも
　　パス→処理対象の内容(画像かテキストか)　の部分を抽象化しておくとか
読みやすさを意識する
　関数には、Googleスタイルのdocstringをつける
　処理のまとまりごとに、コメントをつけ、なんの処理をしているのかがわかるようにする
　ドキュメントはすべて日本語で記述する

ーー追加検討事項
出力するファイルと形式指定のスプシファイルは、基本的には同じものとする
　保存できない場合を想定し、一時ファイルも書き出すようにする
　分析すべき項目は、各行で値が入っていないところとする
　　すでに値が入っている項目については、分析対象から除外する
t_xxx列の内容は、ロジックとして、テキストかファイルパスか、URLかを判断する
　t_xxx列の内容から、分析対象の内容へ変換する処理では、そもそも自らの前処理が担当すべきかを判断するといいかも(下コードブロック参考)
```
class WebPreprocess(Preprocess):
  def is_eligible(self, target_text:str):
    ...
  def preprocess(self, target_text:str):
    ...
```
t_xxxのファイルパスは、スプレッドシートを基準とした相対パスとする
　内部で絶対パス等に解決する
一定数の行分析ごとに、一時ファイルを出力する
　これにより、途中で予期せぬ終了があっても、続きから分析ができる

ーー使用用途
Webページ内容の一括解析

